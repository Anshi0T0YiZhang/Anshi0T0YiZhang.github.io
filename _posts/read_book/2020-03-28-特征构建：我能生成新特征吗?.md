---
title: "特征构建：我能生成新特征吗?"
subtitle: "《特征工程入门与实践》03"
layout: post
author: "echisenyang"
header-style: text
hidden: true
catalog: true
tags:
  - book
  - 《特征工程入门与实践》
---



## 特征构建：我能生成新特征吗?

> 在上一章中，我们借助“皮马印第安人糖尿病预测数据集”理解了哪些现有特征最有价值。 在使用现有特征时，我们识别了各列的缺失值，使用不同的方法删除或填充了缺失值，并对数据 进行标准化/归一化，从而提高了机器学习模型的准确率。

> 本章概要：
>
> 1）检查数据集； 
>
> 2）填充分类特征； 
>
> 3）编码分类变量； 
>
> 4）扩展数值特征； 
>
> 5）针对文本的特征构建。

### 2）填充分类特征

> 我们要写一个 自己的转换器，也就是一个填充每列缺失值的方法。
>
> 我们先从定性列 city 开始。对于**数值数据**，可以通过计算**均值**的方法填充缺失值；而对于 **分类数据**，我们也有类似的处理方法：计算出**最常见的类别**用于填充。
>
> `X['city'].fillna(X['city'].value_counts().index[0])`

#### 自定义分类填充器

> 首先，用 scikit-learn 的 TransformerMixin 基类创建我们的自定义分类填充器。这个转换 器（以及本章中的其他转换器）会作为流水线的一环，实现 fit 和 transform 方法。

```python
from sklearn.base import TransformerMixin

class CustomCategoryImputer(TransformerMixin):
    def __init__(self, cols=None):
    		self.cols = cols
    		
    def transform(self, df):
    		X = df.copy() for col in self.cols:
    		X[col].fillna(X[col].value_counts().index[0], inplace=True) 
    		return X
    		
    def fit(self, *_):
    		return self
```

> 我们的 city 和 boolean 列都没有缺失值了。不过**定量列**还是有缺失值。既然默 认的填充器不能选择列，我们再来自定义一个。

#### 自定义定量填充器

> 我们使用的结构和自定义分类填充器类似。主要的区别在于，此处用 scikit-learn 的 Imputer 类实现一个自定义的转换器，对列进行转换：

```python
from sklearn.preprocessing import Imputer 

class CustomQuantitativeImputer(TransformerMixin):
		def __init__(self, cols=None, strategy='mean'):
				self.cols = cols 
				self.strategy = strategy

		def transform(self, df):
				X = df.copy() 
				impute = Imputer(strategy=self.strategy) 
				for col in self.cols:
						X[col] = impute.fit_transform(X[[col]]) 
        return X

		def fit(self, *_):
				return self
```