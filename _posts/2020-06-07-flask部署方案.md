```
layout:     post
title:      flask部署方案
subtitle:   efficient mac
date:       2020-06-07
author:     Young
hidden: true
catalog: true
tags:
    - tools
```



效果图

![l71nKt](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/l71nKt.png)

![wqGnre](https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/wqGnre.png)

干货，不多说了，直接上架构图和对应代码

### 框架结构

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/YFgFkF.jpg" alt="YFgFkF" style="zoom:50%;" />

### setup.py

```python
from __future__ import print_function
from setuptools import setup, find_packages
import sys

setup(
    name="paraphrase",
    version="0.1.0",
    author="",
    author_email="",
    description="Python Framework.",
    license="MIT",
    url="http://git.seek-data.com/dev/paraphrase/",
    packages=find_packages(),
    entry_points={
        # 'console_scripts': [
        #     'tracer = tracer.__main__:main'
        # ]
    },
    # data_files=[('cfg', ['extractor/config/extractor.cfg'])
    #             ],
    include_package_data=True,
    classifiers=[
        "Environment :: Web Environment",
        'Intended Audience :: Developers',
        'License :: OSI Approved :: MIT License',
        'Natural Language :: Chinese',
        'Operating System :: MacOS',
        'Operating System :: Microsoft',
        'Operating System :: POSIX',
        'Operating System :: Unix',
        'Topic :: NLP',
        'Topic :: Software Development :: Libraries :: Python Modules',
        'Programming Language :: Python :: 3.5',
        'Programming Language :: Python :: 3.6',
    ],
    install_requires=[
            'pandas',
            'numpy',
            'argparse',
            'Flask==1.0.2',
            'flask_restplus==0.11.0',
            'flask-cors',
            'tensorflow-gpu==1.12.0',
            'tqdm',
            'pytest',
            'monitor-python>=0.1.0'
    ],
    zip_safe=True,
)

```

### wsgi.py

```python
from nmt.__main__ import app as application


if __name__ == "__main__":
    application.run(host='0.0.0.0', debug=False, port=5000)
```

### apis.\__init__

```python
from flask_restplus import Api

from nmt.apis.paraphrase_flask import ns as para

api = Api(
    title='Paraphrase',
    version='1.0',
    description='Python Backend of Event Store.',
    # All API metadatas
)

api.add_namespace(para)
```

### apis.paraphrase_flask

```python
from flask_restplus import Namespace, Resource, fields
import importlib
from paraphrase_predictor import ParaphrasePredictor
import json
import logging

ns = Namespace('paraphrase_predictor/infer', description='Python Web Framework of Keydriver')

para_predictor = ParaphrasePredictor()

news = ns.model('paraphrase', {
    'news': fields.String(required=True, description='The split list of news title'),
})


@ns.route('/paraphrase_flask')
@ns.response(404, 'Class not found')
class ParaphraseInfer(Resource):
    @ns.expect(news)
    @ns.doc('para')
    def post(self):
        obj = ns.payload
        news = obj['news']
        preds = para_predictor.paraphrase_predict([news])
        return json.dumps(preds, ensure_ascii=False)

    @ns.doc('para')
    def get(self):
        random_title = para_predictor.random_retrieve()
        return json.dumps(random_title, ensure_ascii=False)
```

### \__init__

```python
import logging


def get_logger(name, level):
    logging.basicConfig(format='%(levelname)s: %(message)s - %(asctime)s - %(pathname)s[line:%(lineno)d] ',
                        level=level)
    return logging.getLogger(name)
```

### \__main__

```python
from flask import Flask
from nmt.apis import api
from flask import Flask,Response,abort,render_template,request,redirect,url_for
import json


app = Flask(__name__)


api.init_app(app)

@app.route("/health")
def health():
    result = {'status': 'UP'}
    return Response(json.dumps(result), mimetype='application/json')


if __name__ == "__main__":
    app.run(host='0.0.0.0', debug=False)
```

