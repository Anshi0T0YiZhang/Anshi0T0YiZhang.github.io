---
title: "「白板推导笔记」13-16"
subtitle: "Machine Learning Session"
layout: post
author: "echisenyang"
header-style: text
hidden: true
catalog: true
tags:
  - 笔记
  - 白板推导笔记
---



# 白板推导笔记

## 系列十三 MCMC

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/VC59gh.jpg" />

### 采样方法介绍

- MCMC：近似推断-随机推断
  - 基于采样的随机近似数值积分
  - 推断是用来求后验的积分
  - 积分难求，转而用采样的方式
- 采样方法
  - 概率分布采样
    - 方法：cdf是0-1之间的非递减函数，在纵轴0-1上采样，然后采样得 $x=cdf^{-1}(y)$
    - 缺陷：但是 pdf -> cdf 非常难求
  - Rejection Sampling 拒绝采样
    - 引入提议分布：$q(z)$
    - 从 $q(z)$ 得到样本点，然后看是否符合 $p(z)$
      - 用接受率表示：落到阴影部分接受，落到空白部分拒绝
    - 非常依赖于 $q(z)$ 的形式，但是无法保证假设出一个合适的 $q(z)$
  - Importance Sampling
    - 引入提议分布：$q(z)$
    -  对每个采样点进行加权，但是同样严重依赖于 $q(z)$ 与 $p(z)$ 的相似程度
    - Sampling-Importance-Resampling

### 马尔可夫链

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/LpjExv.jpg" />

- **随机过程**：研究对象是一个离散的随机变量序列而不是一个随机变量
  - 马氏链是一种特殊的随机过程
  - 马尔可夫性质：无后效性
    - 未来与过去无关，只与现在有关
  - 齐次（一阶）马尔可夫性质：
    - 当前状态只与上一个状态有关，与过去状态无关
    - 转移矩阵
    - 平稳分布

### MH算法 Metropolis-Hasting 

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/5GSCV7.jpg" />

- **要解决的问题：如何找到满足 detailed balance 的转移矩阵**

- 引入 $Q$：proposal matrix

  - 但是 $p(z) \cdot Q(z \mapsto z^{*}) \ne p(z^{*}) \cdot Q(z^{*} \mapsto z)$
  - 故引入接受率 $\alpha$

  - 从而 构造等式 满足 detailed balance

- Metropolis-Hasting 

  - 与 Rejection Sampling 的区别：
    - 当小于的时候没有拒绝，而是采用上一个样本
  - 则得到 N 个样本点
  - 从而求和算出之前不好求的 $p(z)$

### 吉布斯算法 Gibbs

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/8v0oQY.jpg" /> 

- Gibbs采样
  - 是一个特殊的 MH 采样，接受率为 1 

### MCMC 回顾重讲

- 回顾蒙特卡洛算法回顾，讲的不好的重讲

  - **采样的动机**：

    1. 采样本身就是常见的任务
    2. 求和求积分运算的简化

  - 假设已经采出了一些样本，那么**什么样的样本是好的样本**？

    - $X^{(1)},X^{(2)},...,X^{(N)} \sim P(X)$

    1. 样本趋向于高概率区域

       比如高斯分布采样集中在中间高出，如果都是采在边缘，那么采样是失败的，无法代表真实的分布

    2. 样本与样本之间最好相互独立

  - **采样是困难的**

    - $p(x)=\frac{1}{z}\hat{p}(x)$
    - 简单的可以直接采样：$pdf \to cdf \to x=cdf^{-1}(y)$
      - 困难1: 但是 partition function $z$ 一般 intractable
      - 困难2: 高维 high dimension

  - **所以 引入提议分布：$q(z)$ 绕过直接采样，转为逼近**

    - Rejection Sampling
    - Importance Sampling

  - **MCMC：构建 马氏链去逼近target distribution**

    - MH
    - Gibbs

### MCMC 回顾平稳分布

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/Bskb66.jpg" />

- 借助构建马氏链

  - **<font color=red>马氏链性质：经过若干步，马氏链会收敛到一个分布，叫平稳分布</font>**

    - **<font color=red>启发：构造马尔可夫链，让要采样的分布为收敛的平稳分布，从而绕过了无法直接采样的问题</font>**

  - 平稳分布：

    - 达到均态：在某一步后，状态分布都相同

      $q^{(1)}(x) \ne q^{(2)}(x) \ne q^{(t)}(x) \ne q^{(t+1)}(x), q^{(m)}(x) = q^{(m+1)}(x)=q^{(m+2)}(x)=...$
  
    - 状态转移矩阵（随机矩阵）
      <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/sU2v5W.jpg" style="zoom: 43%;" />
    
      - 随机矩阵的性质：特征值的绝对值小于1

### MCMC 回顾采样思路及面临的困难

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/eZsUfK.jpg" />

- MCMC：利用马氏链收敛于平稳分布，设计 Q ，使得平稳分布 $q(x)$ 近似于 目标分布 $p(x)$
- 燃烧期：burn-in
  - 燃烧期花的时间：mixing-time
- MCMC问题：
  - 理论只保证收敛，但是不知道何时收敛
  - 混合时间过长
    - $p(x)$ 太复杂，本质还是高维及相关性
  - 样本之间有一定的相关性（马氏链硬伤）

## 系列十四 隐马尔可夫模型

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/myQvv1.jpg" />

### 背景

- Hidden Markov Model

  - 概率图 + time -》dynamic model

    - 横向为 time
    - 纵向为 mixture

  - **第一部分：一个模型**

    - 初始概率矩阵
    - 状态转移矩阵
    - 发射矩阵：状态到观测变量

  - **第二部分：两个假设**

    1. **齐次马尔可夫假设**（无后效行，$i_{t+1}$ 只与  $i_{t}$ 有关）
    2. **观测独立假设**（$o_{t}$ 只与  $i_{t}$ 有关）

  - **第三部分：三个问题**

    1. **Evaluation**: 已知 $\lambda$ 求 $P(O \mid \lambda)$

       前向算法

    2. **Learning**:  $\lambda$ 如何求？

       EM算法

    3. **Decoding**: 找到一个状态序列使得 $P(I \mid O)$

       预测问题、滤波问题

### Evaluation 前向算法

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/KAyMK9.jpg" />

- **Evaluation问题**
  - 计算成指数级增加转而用**前向算法**
    - 找到递归式
  - 后向算法从后往前推（下一讲）

### Evaluation 后向算法

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/4BS5my.jpg" />

- **后向算法**
  - $i_{t+1}$ 把 $i_{t}$ 与 $o_{t+1}$ 阻断

### Learning Baum-Welch 算法

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/HQ5cpL.jpg" />

- EM 公式 
  - 改写后验
  - 以 $\pi$ 为例
  - 有约束，引入拉格朗日乘子法

### Decoding Viterbi算法

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/RtCWXn.jpg" />

- 可以看作动态规划问题

  <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/XW7atl.jpg" style="zoom: 67%;" />

### 小结1

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/2SphzJ.jpg" />

### 小结2 Filtering Smoothing Prediction

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/dlVSn1.jpg" />

- **Filtering**：

  - $p(z_t|x_{1:t}) \propto \alpha_t$
  - 故可以用 **前向 算法**

- **Smoothing**：

  - $p(z_t|x_{1:T}) \propto \alpha_t \beta_t$

  - **阻塞**

    <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/iE4548.jpg" style="zoom: 67%;" />

  - 故可以用 **前向-后向 算法**

- **Prediction**：

  - **前向算法**

## 系列十五 线性动态系统

### 背景介绍

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/zIqSFF.jpg" />

- HMM 
  - 隐状态 z 是离散的，输入 x 是连续的
  - 参数：$\lambda=(\pi,A,B)$
- **线性动态系统**(本章介绍) 
  - 隐状态 z 是连续的，输入 x 是连续的
  - 卡曼滤波或线性高斯模型
- 非线形动态系统
  - 非线形，非高斯

### Filtering问题

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/5OF4Ya.jpg" />

- 已知 $x_1,...,x_t$，求与 $z_t$ 的关系
- $p(z_t|x_1,...,x_t)=\frac{p(x_1,...,x_t,z_t)}{p(x_1,...,x_t)}$
  - 又因为 $p(x_1,...,x_t)$ 为已知常量，故可以写成第一步的正比于关系
- 第二个等号：因为 观测独立性假设 $x_t$ 只与 $z_t$ 有关系
- 第二个 正比于关系：转为prediction问题
- 找到递推式

### Filtering问题求解

<img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/WK7R4B.jpg" />

- 由 $p(x),p(y|x)$推出 $p(y),p(x|y)$
- 套公式

## 系列十六 线性滤波

### 背景介绍

<p align="center">
  <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/JpLkuK.jpg" style="zoom:80%" />
</p>

### Importance sampling&SIS 没听懂

<p align="center">
  <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/J6MwOX.jpg" style="zoom:80%" />
</p>

### 重采样

<p align="center">
  <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/nSzzMm.jpg" style="zoom:80%" />
</p>

### SIR Filter

<p align="center">
  <img src="https://gitee.com/echisenyang/GiteeForUpicUse/raw/master/uPic/WH1ruE.jpg" style="zoom:80%" />
</p>